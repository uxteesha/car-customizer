<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Car Customizer with Hotspots & Animation (Fixed)</title>
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>
    <style>
        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            font-family: sans-serif; background: #f0f0f0;
        }
        .viewer-container { width: 100%; height: 100%; position: relative; }
        model-viewer { width: 100%; height: 100%; }

        /* Customization Controls Panel Styles */
        .controls-panel {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255,255,255,0.9); border-radius: 12px;
            padding: 15px; display: flex; flex-direction: column;
            align-items: center; gap: 15px;
            z-index: 11;
        }
        .button-list { display: flex; gap: 10px; }
        .color-selector {
            width: 45px; height: 45px; border-radius: 50%; border: 2px solid #fff;
            cursor: pointer;
        }
        .tyre-btn, .mode-btn {
            padding: 8px 16px; border: none; border-radius: 8px;
            cursor: pointer; font-weight: 600; color: #fff;
        }
        .tyre-btn { background: #007bff; }
        .mode-btn { background: #28a745; }

        /* Hotspot Info Panel Styles */
        #info-panel {
            display: none; 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 20px; border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); z-index: 10;
        }
        #close-panel {
            margin-top: 10px; padding: 5px 10px; cursor: pointer;
        }
        
        /* Hotspot Dot Styles */
        .Hotspot {
            background: #fff; 
            border: 2px solid #007bff; 
            border-radius: 50%;
            width: 20px; 
            height: 20px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            padding: 0; 
            cursor: pointer;
        }
        .HotspotAnnotations, .HotspotAnnotation {
            display: none; 
        }

        /* Door Animation Button Style */
        .Hotspots { 
            background: rgba(255, 255, 255, 0.8); 
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 5px 10px;
            font-size: 14px;
            cursor: pointer;
            color: #333;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            display: block; 
        }
        .Hotspots .HotspotAnnotations {
            display: block; 
        }
    </style>
</head>
<body>
    <div class="viewer-container">
        <model-viewer
            id="car-model"
            src="Pink futuristic real.glb"
            alt="A 3D model of a car"
            ar
            ar-modes="webxr scene-viewer quick-look"
            ar-placement="floor"
            ar-scale="fixed"
            scale="1 1 1"
            shadow-intensity="1"
            shadow-softness="0.8"
            camera-controls
            auto-rotate>
            
            <button class="Hotspots" slot="hotspot-2" data-surface="79 0 2387 905 2388 0.265 0.158 0.577" data-visibility-attribute="visible">
                <div class="HotspotAnnotations">Open Doors</div>
            </button>

            <button class="Hotspot" 
            slot="hotspot-3" 
            data-position="-1.0129080117791056m 0.4496240760795325m -1.8568594526380542m" 
            data-normal="-0.5230824020171959m 0.8378915599439669m 0.15595683529293122m" 
            data-visibility-attribute="visible" 
            data-title="Tyres" 
            data-description="19-inch Diamond-cut Graphene Alloy wheels (airless, self-sealing, magnetic levitation).">
                <div class="HotspotAnnotation"></div> 
            </button>

            <button class="Hotspot" 
            slot="hotspot-4"
            data-position="0.08555671925668895m 1.316307781640377m -1.9664828641073007m" 
            data-normal="0.010006396645117367m 0.9927707036953178m -0.1196085361104477m" 
            data-visibility-attribute="visible" 
            data-title="Speed" 
            data-description="100 km/r within 1.45 seconds. Governed Speed 350km/h">
                <div class="HotspotAnnotation"></div>
            </button>

            <button class="Hotspot" 
            slot="hotspot-5" 
            data-position="-0.1819589114957214m 1.9816244770250495m 0.26479836268620427m" 
            data-normal="-0.02959233215327415m 0.9942860855126491m -0.10256448719544028m" 
            data-visibility-attribute="visible" 
            data-title="WindowsElectro" 
            data-description="Chromic Smart Glass serves as a full Augmented Reality HUD.">
                <div class="HotspotAnnotation"></div>
            </button>

            <button class="Hotspot" 
            slot="hotspot-6" 
            data-position="-0.026758096050141084m 0.9639880037994947m 2.5179298326685178m" 
            data-normal="-0.0075662832498763054m -0.0010722259778223984m 0.9999708004183098m" 
            data-visibility-attribute="visible" 
            data-title="Mileage" 
            data-description="Perpetual Range (Effectively Infinite)">
                <div class="HotspotAnnotation"></div>
            </button>

            <button class="Hotspot" 
            slot="hotspot-7" 
            data-position="1.0140414410935739m 1.1741242531324094m 0.9727303427697893m" 
            data-normal="0.9613706407267112m 0.26095995008274536m -0.0875579556723677m" 
            data-visibility-attribute="visible" 
            data-title="Engine Tri-Core" 
            data-description="Quantum Fusion Drive (QFD): Zero-emission, silent power.">
                <div class="HotspotAnnotation"></div>
            </button>

            <button class="Hotspot" 
            slot="hotspot-8"  
            data-position="1.0140414789387980m 1.1741467829189032m 0.9727303427697893m" 
            data-normal="0.9613706407267112m 0.26095995008274536m -0.0875579556723677m" 
            data-visibility-attribute="visible" 
            data-title="Key Technology" 
            data-description="Omni-Pilot AI and Bio-Lock interior (adapts to occupant comfort).">
                <div class="HotspotAnnotation"></div>
            </button>
        </model-viewer>
        
        <div id="info-panel">
            <h3 id="panel-title"></h3>
            <p id="panel-content"></p>
            <button id="close-panel">Close</button>
        </div>

        <div class="controls-panel">
            <button id="modeSwitch" class="mode-btn">Switch to Tyre Mode</button>

            <div id="colorControls">
                <h4>Body Color</h4>
                <div class="button-list">
                    <button class="color-selector" data-model="Pink futuristic real.glb" style="background:pink;"></button>
                    <button class="color-selector" data-model="Blue futuristic car real size.glb" style="background:blue;"></button>
                    <button class="color-selector" data-model="Green futuristic real.glb" style="background:green;"></button>
                </div>
            </div>

            <div id="tyreControls" style="display:none;">
                <h4>Tyres</h4>
                <div class="button-list">
                    <button class="tyre-btn" data-model="Blue futuristic car real size.glb">Style 1</button>
                    <button class="tyre-btn" data-model="Blue futuristic tyre 2.glb">Style 2</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const modelViewer = document.getElementById('car-model');
        
        // --- Customization Logic ---
        const modeSwitch = document.getElementById('modeSwitch');
        const colorControls = document.getElementById('colorControls');
        const tyreControls = document.getElementById('tyreControls');
        let currentMode = 'color';

        // Switch modes
        modeSwitch.addEventListener('click', () => {
            if (currentMode === 'color') {
                currentMode = 'tyre';
                colorControls.style.display = 'none';
                tyreControls.style.display = 'block';
                modeSwitch.textContent = 'Switch to Color Mode';
            } else {
                currentMode = 'color';
                colorControls.style.display = 'block';
                tyreControls.style.display = 'none';
                modeSwitch.textContent = 'Switch to Tyre Mode';
            }
        });

        // Handle button clicks for customization
        function attachHandlers(selector) {
            document.querySelectorAll(selector).forEach(button => {
                button.addEventListener('click', () => {
                    const modelFile = button.getAttribute('data-model');
                    if (modelFile) {
                        modelViewer.src = modelFile;
                        modelViewer.setAttribute('scale', '1 1 1');
                    }
                });
            });
        }
        attachHandlers('.color-selector');
        attachHandlers('.tyre-btn');
        
        // --- Hotspot and Animation Logic ---
        
        document.addEventListener('DOMContentLoaded', () => {
            const infoPanel = document.getElementById('info-panel');
            const panelTitle = document.getElementById('panel-title');
            const panelContent = document.getElementById('panel-content');
            const closeButton = document.getElementById('close-panel');

            // Hotspot click handling to show the info panel
            const hotspots = document.querySelectorAll('.Hotspot');
            hotspots.forEach(hotspot => {
                hotspot.addEventListener('click', (event) => {
                    event.preventDefault();
                    
                    const title = hotspot.getAttribute('data-title');
                    const description = hotspot.getAttribute('data-description');

                    panelTitle.textContent = title;
                    panelContent.textContent = description;

                    infoPanel.style.display = 'block';
                });
            });
            
            // Close panel button
            closeButton.addEventListener('click', () => {
                infoPanel.style.display = 'none';
            });
            
            // Door animation logic
            const doorHotspot = modelViewer.querySelector('button[slot="hotspot-2"]');

            // Check for animation availability after the model loads/changes
            modelViewer.addEventListener('load', () => {
                const availableAnimations = modelViewer.availableAnimations;
                const hasDoorAnimation = availableAnimations.includes('doorsOpeningAction');

                if (!hasDoorAnimation) {
                    console.warn("Current model does NOT have 'doorsOpeningAction' animation. Door button might not work.");
                }
            });

            // Attach click listener for the door hotspot
            if (doorHotspot) {
                doorHotspot.addEventListener('click', () => {
                    const availableAnimations = modelViewer.availableAnimations;
                    if (availableAnimations.includes('doorsOpeningAction')) {
                        modelViewer.currentTime = 0;
                        modelViewer.animationName = 'doorsOpeningAction';
                        modelViewer.play();

                        const durationInSeconds = modelViewer.duration;

                        if (durationInSeconds > 0) {
                            setTimeout(() => {
                                modelViewer.pause();
                            }, durationInSeconds * 1000);
                        }
                    } else {
                        alert("Door opening animation not available for this model. Ensure 'doorsOpeningAction' is in your current GLB file.");
                        console.warn("Attempted to play 'doorsOpeningAction' but it's not available.");
                    }
                });
            }
        });
    </script>
</body>
</html>
