<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AR Car Customizer — Hotspots & Animation (merged)</title>

  <!-- Use model-viewer v4 -->
  <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/4.0.0/model-viewer.min.js"></script>

  <style>
    html,body{height:100%;margin:0;background:#f0f0f0;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial;}
    model-viewer{width:100%;height:100vh;display:block}

    /* Controls panel (unchanged UI) */
    .controls-panel{
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255,255,255,0.92);
      padding: 12px 14px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
      z-index: 20;
    }
    .button-list{display:flex;gap:10px;align-items:center}
    .color-selector{width:44px;height:44px;border-radius:50%;border:2px solid #fff;cursor:pointer;box-shadow:0 2px 8px rgba(0,0,0,.12)}
    .mode-btn,.tyre-btn{padding:8px 14px;border-radius:8px;border:0;cursor:pointer;font-weight:600;color:#fff}
    .mode-btn{background:#28a745} .tyre-btn{background:#007bff}

    /* Hotspot dot (visible always) */
    .Hotspot{
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: #007bff;
      border: 2px solid #fff;
      box-shadow: 0 3px 8px rgba(0,0,0,0.25);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    /* Annotation that appears next to the dot when active */
    .HotspotAnnotation{
      display: none;            /* hidden by default */
      white-space: nowrap;
      background: rgba(255,255,255,0.95);
      color: #111;
      padding: 6px 8px;
      border-radius: 8px;
      font-weight: 700;
      font-size: 13px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.12);
      transform-origin: left center;
    }
    /* When hotspot element has class "open" show its annotation */
    .Hotspot.open .HotspotAnnotation { display: inline-block; }

    /* small accessibility tweak so panel is above model-viewer content */
    .controls-panel button { outline: none; }
  </style>
</head>
<body>
  <!-- MODEL VIEWER (base: your working code) -->
  <model-viewer
    id="car-viewer"
    src="assets/Futurecar.glb"           <!-- your working file path — keep as in your working URL -->
    poster="assets/poster.png"
    alt="Futuristic Car"
    ar
    ar-modes="scene-viewer quick-look webxr"
    ar-placement="floor"
    ar-scale="fixed"
    camera-controls
    shadow-intensity="1"
    field-of-view="30deg"
    xr-environment
    disable-pan>

    <!-- ---------- KEEP ALL YOUR ORIGINAL HOTSPOTS with positions/normals/surface ATTRIBUTES ---------- -->

    <!-- door hotspot (uses your data-surface) -->
    <button class="Hotspot" slot="hotspot-2"
      data-surface="79 0 2387 905 2388 0.265 0.158 0.577"
      data-visibility-attribute="visible">
      <!-- dot only visible; annotation hidden until click -->
      <div class="HotspotAnnotation">Open Doors</div>
    </button>

    <!-- other hotspots (kept your exact positions / normals / meta from earlier) -->
    <button class="Hotspot" slot="hotspot-3"
      data-position="-1.0129080117791056m 0.4496240760795325m -1.8568594526380542m"
      data-normal="-0.5230824020171959m 0.8378915599439669m 0.15595683529293122m"
      data-visibility-attribute="visible"
      data-title="Tyres"
      data-description="19-inch Diamond-cut Graphene Alloy wheels (airless, self-sealing, magnetic levitation).">
      <div class="HotspotAnnotation">Tyres</div>
    </button>

    <button class="Hotspot" slot="hotspot-4"
      data-position="0.08555671925668895m 1.316307781640377m -1.9664828641073007m"
      data-normal="0.010006396645117367m 0.9927707036953178m -0.1196085361104477m"
      data-visibility-attribute="visible"
      data-title="Speed"
      data-description="100 km/r within 1.45 seconds. Governed Speed 350km/h">
      <div class="HotspotAnnotation">Speed</div>
    </button>

    <button class="Hotspot" slot="hotspot-5"
      data-position="-0.1819589114957214m 1.9816244770250495m 0.26479836268620427m"
      data-normal="-0.02959233215327415m 0.9942860855126491m -0.10256448719544028m"
      data-visibility-attribute="visible"
      data-title="WindowsElectro"
      data-description="Chromic Smart Glass serves as a full Augmented Reality HUD.">
      <div class="HotspotAnnotation">WindowsElectro</div>
    </button>

    <button class="Hotspot" slot="hotspot-6"
      data-position="-0.026758096050141084m 0.9639880037994947m 2.5179298326685178m"
      data-normal="-0.0075662832498763054m -0.0010722259778223984m 0.9999708004183098m"
      data-visibility-attribute="visible"
      data-title="Mileage"
      data-description="Perpetual Range (Effectively Infinite)">
      <div class="HotspotAnnotation">Mileage</div>
    </button>

    <button class="Hotspot" slot="hotspot-7"
      data-position="1.0140414410935739m 1.1741242531324094m 0.9727303427697893m"
      data-normal="0.9613706407267112m 0.26095995008274536m -0.0875579556723677m"
      data-visibility-attribute="visible"
      data-title="Engine Tri-Core"
      data-description="Quantum Fusion Drive (QFD): Zero-emission, silent power.">
      <div class="HotspotAnnotation">Engine Tri-Core</div>
    </button>

    <button class="Hotspot" slot="hotspot-8"
      data-position="1.0140414789387980m 1.1741467829189032m 0.9727303427697893m"
      data-normal="0.9613706407267112m 0.26095995008274536m -0.0875579556723677m"
      data-visibility-attribute="visible"
      data-title="Key Technology"
      data-description="Omni-Pilot AI and Bio-Lock interior (adapts to occupant comfort).">
      <div class="HotspotAnnotation">Key Technology</div>
    </button>

  </model-viewer>

  <!-- -------- Controls panel merged from your other code -------- -->
  <div class="controls-panel" role="region" aria-label="controls">
    <button id="modeSwitch" class="mode-btn">Switch to Tyre Mode</button>

    <div id="colorControls">
      <strong>Body Color</strong>
      <div class="button-list">
        <button class="color-selector" data-model="Pink futuristic real.glb" style="background:pink" title="Pink"></button>
        <button class="color-selector" data-model="Blue futuristic car real size.glb" style="background:blue" title="Blue"></button>
        <button class="color-selector" data-model="Green futuristic real.glb" style="background:green" title="Green"></button>
      </div>
    </div>

    <div id="tyreControls" style="display:none">
      <strong>Tyres</strong>
      <div class="button-list">
        <button class="tyre-btn" data-model="Blue futuristic car real size.glb">Style 1</button>
        <button class="tyre-btn" data-model="Blue futuristic tyre 2.glb">Style 2</button>
      </div>
    </div>
  </div>

<script>
  (function(){
    const modelViewer = document.getElementById('car-viewer');

    // HOTSPOT BEHAVIOR: dots that show annotation next to them when clicked.
    // Keep hotspot elements and annotations exactly as you authored — we only toggle visibility.
    const allHotspots = Array.from(document.querySelectorAll('.Hotspot'));

    function closeAllHotspotAnnotations() {
      allHotspots.forEach(h => h.classList.remove('open'));
    }

    // Add click listeners to hotspots.
    allHotspots.forEach(h => {
      h.addEventListener('click', (ev) => {
        ev.stopPropagation(); // avoid bubbling to model-viewer click handler

        // Toggle this hotspot annotation; close others
        const alreadyOpen = h.classList.contains('open');
        closeAllHotspotAnnotations();
        if (!alreadyOpen) h.classList.add('open');

        // If this is the door hotspot (your slot="hotspot-2"), also trigger the animation.
        // (This preserves your exact original animation behavior.)
        const slot = h.getAttribute('slot') || '';
        if (slot === 'hotspot-2') {
          triggerDoorAnimation();
        }
      });
    });

    // Clicking anywhere else on the model-viewer should close annotations.
    modelViewer.addEventListener('click', () => {
      closeAllHotspotAnnotations();
    });

    // Door animation helper (keeps your original pattern)
    function triggerDoorAnimation() {
      try {
        modelViewer.currentTime = 0;
        modelViewer.animationName = 'doorsOpeningAction'; // must match your GLB animation name
        modelViewer.play();

        // Pause after duration (if available)
        const dur = modelViewer.duration || 0;
        if (dur > 0) {
          setTimeout(() => { modelViewer.pause(); }, dur * 1000);
        }
      } catch (err) {
        console.warn('Door animation failed:', err);
      }
    }

    // COLOR / TYRE SWITCHER (merged in)
    const modeSwitch = document.getElementById('modeSwitch');
    const colorControls = document.getElementById('colorControls');
    const tyreControls = document.getElementById('tyreControls');
    let currentMode = 'color';

    modeSwitch.addEventListener('click', () => {
      if (currentMode === 'color') {
        currentMode = 'tyre';
        colorControls.style.display = 'none';
        tyreControls.style.display = 'block';
        modeSwitch.textContent = 'Switch to Color Mode';
      } else {
        currentMode = 'color';
        colorControls.style.display = 'block';
        tyreControls.style.display = 'none';
        modeSwitch.textContent = 'Switch to Tyre Mode';
      }
      // Hide any open hotspot annotations when switching modes:
      closeAllHotspotAnnotations();
    });

    function attachHandlers(selector) {
      document.querySelectorAll(selector).forEach(button => {
        button.addEventListener('click', () => {
          const modelFile = button.getAttribute('data-model');
          if (!modelFile) return;
          // change model source — keep hotspots (they are separate elements)
          modelViewer.src = modelFile;
          modelViewer.setAttribute('scale','1 1 1'); // keep proportions
          // close annotations to avoid leftover popups
          closeAllHotspotAnnotations();
        });
      });
    }
    attachHandlers('.color-selector');
    attachHandlers('.tyre-btn');

    // small helpful logging if model fails to load — keep you debuggable
    modelViewer.addEventListener('error', (e) => {
      console.error('model-viewer error:', e);
      // optional: alert or show debug overlay if you prefer
    });
  })();
</script>
</body>
</html>
